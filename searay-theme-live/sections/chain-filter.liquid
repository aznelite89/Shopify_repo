{%- assign coll = section.settings.custom_collection | default: collection -%}

<section id="chain-filter" class="page-width">

  <form id="FacetFiltersForm" class="facets-horizontal" method="get" action="{{ coll.url }}">
    <div class="facets-body">
      {% assign desired_order = "Color|Alloy|Availability|Length|Weight|Price|Width|Design" | split: "|" %}
      {% for label in desired_order %}
        {% assign filter = coll.filters | where: "label", label | first %}
        {% if filter %}
          <div class="facet-row" data-label="{{ filter.label }}">
            <span class="facet-label">{{ filter.label }}:</span>

            {% if filter.type == 'list' and filter.label == 'Design' %}

              {%- comment -%} åœ¨è¿™é‡Œå…ˆå®šä¹‰ design_groupsï¼ŒåŠ¡å¿…å†™åœ¨ <div> ä¹‹å¤– {%- endcomment -%}
              {% assign design_groups = "
                Anchor:Anchor Chains:Anchor,
                Ball:Ball Chains:Ball,
                Belcher:Belcher Chains:Belcher,
                Birdseye:Birdseye / Tiger Eye Chains:Birdseye,
                Box:Box Chains:Box,
                Trace | Cable:Cable | Trace | Oval Link Chains:Cable,
                Curb:Curb Chains:Curb,
                Fancy:Fancy Chains P/G:Fancy,
                Figaro:Figaro Chains:Figaro,
                Franco:Franco Chains:Franco,
                ID Bracelets: ID Bracelets: ID Bracelets,
                Wheat | Round:Magic Chains:Round,
                Omega:Omega Chains:Omega,
                Paperclip:Paperclip Chains:Paperclip,
                Rope:Rope Chains:Rope,
                Rosary:Rosary Chains:Rosary,
              " | split: "," %}
            
              <div class="facet-values">
                {% for grp in design_groups %}
                  {% assign parts    = grp | split: ":" %}
                  {% assign key      = parts[0] | strip %}
                  {% assign raw_label = parts[1] | strip %}
                  {% assign image_key = parts[2] | strip %}
                  {% assign item     = filter.values | where: "label", raw_label | first %}
                  {% if item %}
                    <label class="facet-value design-value">
                      <input
                        type="checkbox"
                        name="{{ filter.param_name }}"
                        value="{{ item.value }}"
                      >
                      <span class="design-icon">
                        <img
                          src="{{ image_key | append: '.png' | asset_url }}"
                          alt="{{ image_key }}"
                          width="50"
                          height="100"
                        >
                      </span>
                      <span class="design-label">{{ key }} ({{ item.count }})</span>
                  
                    </label>
                  {% endif %}
                {% endfor %}
              </div>            



            
            {% elsif filter.type == 'list' and filter.label == 'Color' %}
              {%- comment -%} åªæ˜¾ç¤ºä¸‰å¼ å›¾ï¼šé»„ã€ç™½ã€ç«ï¼Œæœ€åæŠŠ Black å½“ä½œ Other{%- endcomment -%}
              {% assign primary = "Yellow,White,Rose" | split: "," %}
            
              <div class="facet-values">
                {%- comment -%} ç¬¬ä¸€éï¼šæ¸²æŸ“ Yellow/White/Rose{%- endcomment -%}
                {% for color in primary %}
                  {% assign item = filter.values | where: "label", color | first %}
                  {% if item %}
                    <label class="facet-value color-img-value">
                      <input type="checkbox" name="{{ filter.param_name }}" value="{{ item.value }}">
                      {% case color %}
                        {% when "Yellow" %}
                          <img src="{{ 'Yellow Gold.png' | asset_url }}"
                               alt="Yellow" width="40" height="40">
                        {% when "White" %}
                          <img src="{{ 'White Gold.png' | asset_url }}"
                               alt="White" width="40" height="40">
                        {% when "Rose" %}
                          <img src="{{ 'Rose Gold.png' | asset_url }}"
                               alt="Rose" width="40" height="40">
                      {% endcase %}
                      <span>{{ color }} ({{ item.count }})</span>
                    </label>
                  {% endif %}
                {% endfor %}
            
                {%- comment -%} æœ€åæŠŠ Black ä½œä¸º Other æ¥æ¸²æŸ“{%- endcomment -%}
                {% assign black = filter.values | where: "label", "Black" | first %}
                {% if black %}
                  <label class="facet-value color-img-value">
                    <input type="checkbox" name="{{ filter.param_name }}" value="{{ black.value }}">
                    <span class="color-block"></span>
                    <span>Other ({{ black.count }})</span>
                  </label>
                {% endif %}
              </div>




            {% elsif filter.type == 'list' and filter.label == 'Length' %}
              {% assign mins = nil %}
              {% assign maxs = 0 %}
              {% for v in filter.values %}
                {% if v.value contains '-' %}
                  {% assign parts = v.value | remove:'cm' | split:'-' %}
                  {% assign lo = parts[0] | plus:0 %}
                  {% assign hi = parts[1] | plus:0 %}
                  {% if mins == nil or lo < mins %}{% assign mins = lo %}{% endif %}
                  {% if hi > maxs %}{% assign maxs = hi %}{% endif %}
                {% endif %}
              {% endfor %}


              <div class="length-slider-row">
                 <div class="length-inputs">  
                  <label>Min (cm):
                    <input type="number" id="length-min-ui" step="0.5" min="{{ mins }}" max="{{ maxs }}">
                  </label>
                  <label>Max (cm):
                    <input type="number" id="length-max-ui" step="0.5" min="{{ mins }}" max="{{ maxs }}">
                  </label>
                </div> 
                <div id="length-slider" style="margin-top: 50px; margin-bottom: 20px;"  data-min="{{ mins }}" data-max="{{ maxs }}"></div>
              </div>
              <input type="hidden" id="length-min" value="">
              <input type="hidden" id="length-max" value="">
              <div class="facet-values" style="margin-top:1.5rem;">
                {% for v in filter.values %}
                  {% if v.value contains 'Adjustable' or v.value contains '+' %}
                    <label class="facet-value">
                      <input type="checkbox" name="{{ filter.param_name }}" value="{{ v.value }}">
                      {{ v.label }} ({{ v.count }})
                    </label>
                  {% endif %}
                {% endfor %}
              </div>
              <div id="length-hidden-ranges" style="display:none;">
                {% for v in filter.values %}
                  {% if v.value contains '-' %}
                    <input type="checkbox" class="js-length-range" name="{{ filter.param_name }}" value="{{ v.value }}">
                  {% endif %}
                {% endfor %}
              </div>

            {% elsif filter.type == 'list' %}
              <div class="facet-values">
                {% for v in filter.values %}
                  <label class="facet-value">
                    <input type="checkbox" name="{{ filter.param_name }}" value="{{ v.value }}">
                    <span>{{ v.label }} ({{ v.count }})</span>
                  </label>
                {% endfor %}
              </div>

            {% elsif filter.type == 'price_range' %}
              <div class="facet-values">
                <label>Min:
                  <input type="number" name="{{ filter.min_value.param_name }}" min="{{ filter.range_min }}" max="{{ filter.range_max }}">
                </label>
                <label>Max:
                  <input type="number" name="{{ filter.max_value.param_name }}" min="{{ filter.range_min }}" max="{{ filter.range_max }}">
                </label>
              </div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <div class="facets-actions">
      <button type="submit" class="button button--primary">Search</button>
      <button type="button" id="clear-all" class="button button--secondary">Clear all selections</button>
    </div>
  </form>

  <div id="applied-summary" style="margin:1rem 0; font-size:1.5rem;"></div>

  <style>
    /* â€”â€” æ–°å¢ï¼šè¡¨æ ¼å¸ƒå±€ç›¸å…³ â€”â€” */
    #chain-filter .facets-horizontal {
      display: block; margin: 0; padding: 0;
    }
    #chain-filter .facets-body {
      display: table;
      width: 100%;
      border-collapse: collapse;
    }
    #chain-filter .facet-row {
      display: table-row;
    }
    #chain-filter .facet-label {
      display: table-cell;
      vertical-align: top;
      padding: 0.75rem 1rem;
      font-weight: 600;
      background: #f9f9f9;
      border: 1px solid #ddd;
      white-space: nowrap;
      width: 160px;
    }
    #chain-filter .facet-values,
    #chain-filter .length-slider-row {
      display: table-cell;
      vertical-align: middle;
      padding: 0.75rem 1rem;
      border: 1px solid #ddd;
    }

    /* â€”â€” åŸæœ‰æ ·å¼ï¼ˆæœªåŠ¨ï¼‰ â€”â€” */

    #chain-filter {
      font-family: inherit;
      font-size: 15px;
    }

    /* ä¿ç•™ grid å¸ƒå±€ */
    #chain-filter .facet-values {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 0.75rem 1rem;
    }
    #chain-filter .facet-value {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.5rem;
      border: 1px solid transparent;
      border-radius: 4px;
      transition: background 0.2s, border-color 0.2s;
      cursor: pointer;
    }
    #chain-filter .facet-value:hover {
      background: #f9f9f9;
      border-color: #ccc;
    }

    /* æ»‘å—å°ºå¯¸ */
    #chain-filter .length-slider-row {
      width: 100%;
      height: 100px;
      max-width: none;
      margin: 0;
    }
    #chain-filter #length-slider {
      width: 100%;
      height: 8px;
      margin-top: 2rem;
    }

    /* noUiSlider ä¸»é¢˜ */
    .noUi-target {
      background: #e0e0e0;
      border-radius: 6px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
    }
    .noUi-connect {
      background: #007bff;
      border-radius: 6px;
    }
    .noUi-handle {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 50%;
      box-shadow: 0 0 2px rgba(0,0,0,0.3);
      width: 18px;
      height: 18px;
      top: -6px;
      cursor: pointer;
    }
    .noUi-handle:hover,
    .noUi-handle:focus {
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0,123,255,0.2);
    }
    .noUi-tooltip {
      font-size: 13px;
      padding: 4px 6px;
      background: #333;
      color: #fff;
      border-radius: 4px;
      bottom: 130%;
      transform: translateY(-4px);
    }

    /* â€”â€” Color ä¸“å± â€”â€” */
    #chain-filter .facet-row[data-label="Color"] .facet-values {
      grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
      justify-items: center;
    }
    #chain-filter .facet-row[data-label="Color"] .facet-value {
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
      border: 1px solid #eee;
      border-radius: 8px;
      width: 100px;
      height: 100px;
      text-align: center;
      position: relative;
    }
    #chain-filter .facet-row[data-label="Color"] .color-block {
      display: block;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      border: 1px solid #ccc;
      margin-bottom: 0.25rem;
    }
    #chain-filter .facet-row[data-label="Color"] .facet-value span:last-child {
      font-size: 13px;
    }
    #chain-filter .facet-row[data-label="Color"] .facet-value input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      cursor: pointer;
    }
    #chain-filter .facet-row[data-label="Color"] .facet-value.checked {
      background: rgba(0,123,255,0.1);
      border-color: #007bff;
    }
    #chain-filter .facet-row[data-label="Color"] .facet-value.checked .color-block {
      border-color: #007bff;
    }

    /* Price è¡Œ input é—´è· */
    #chain-filter .facet-row[data-label="Price"] .facet-values label {
      margin-right: 1.5rem;
    }

    /* æŒ‰é’®ç»„ */
    #chain-filter .facets-actions {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 2rem;
    }
    #chain-filter .facets-actions button {
      padding: 0.75rem 1.5rem;
      font-size: 1.5rem;
      font-weight: 600;
      border-radius: 6px;
      min-width: 160px;
      cursor: pointer;
    }
    #chain-filter .facets-actions .button--primary {
      background: #000;
      color: #fff;
      border: none;
    }
    #chain-filter .facets-actions .button--secondary {
      background: #fff;
      color: #000;
      border: 1px solid #ccc;
    }

    /* å·²é€‰æ±‡æ€» */
    #applied-summary {
      margin: 1rem 0 0.5rem;
      font-size: 1rem;
      font-weight: 500;
      line-height: 1.6;
      color: #333;
      text-align: center;
    }

    #chain-filter .facet-row[data-label="Length"] > .facet-values {
      display: none !important;
    }


    /* â€”â€” Design: icon + label æ ¼å­ â€”â€” */
  #chain-filter .facet-row[data-label="Design"] .facet-values {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 1rem;
    justify-items: center;
  }

  #chain-filter .facet-row[data-label="Design"] .design-value {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem;
    border: 1px solid transparent;
    border-radius: 6px;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
  }

  #chain-filter .facet-row[data-label="Design"] .design-icon img {
    width: 50px;
    height: 100px;
    object-fit: contain;
    margin-bottom: 0.5rem;
  }

  #chain-filter .facet-row[data-label="Design"] .design-label {
    font-size: 13px;
    text-align: center;
    line-height: 1.2;
  }

  /* hover & checked */
  #chain-filter .facet-row[data-label="Design"] .design-value:hover {
    background: #f9f9f9;
    border-color: #ccc;
  }
  #chain-filter .facet-row[data-label="Design"] .design-value.checked {
    background: rgba(0,123,255,0.1);
    border-color: #007bff;
  }
  #chain-filter .facet-row[data-label="Design"] .design-value input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    top: 0; left: 0;
  }

  /* 1. ç§»é™¤ Price label çš„å¤šä½™å³è¾¹è· */
  #chain-filter .facet-row[data-label="Price"] .facet-values label {
    margin-right: 0 !important;
  }

  /* 2. ç¾åŒ– Price è¾“å…¥æ¡† */
  #chain-filter .facet-row[data-label="Price"] .facet-values input[type="number"] {
    width: 150px;           /* æ ¹æ®éœ€è¦è°ƒæ•´å®½åº¦ */
    padding: 0.4rem 0.6rem;  /* å†…è¾¹è· */
    border: 1px solid #ccc; /* è¾¹æ¡† */
    border-radius: 4px;     /* åœ†è§’ */
    font-size: 1rem;        /* å­—ä½“å¤§å° */
    line-height: 1.2;
    text-align: left;
    box-sizing: border-box;
  }

  /* 3. éšè—æ•°å­—è¾“å…¥æ¡†çš„ä¸Šä¸‹ç®­å¤´ï¼ˆspinnerï¼‰ */
  #chain-filter .facet-row[data-label="Price"] .facet-values input[type="number"]::-webkit-inner-spin-button,
  #chain-filter .facet-row[data-label="Price"] .facet-values input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  #chain-filter .facet-row[data-label="Price"] .facet-values input[type="number"] {
    -moz-appearance: textfield;
  }

  /* è®© Color çš„ img ä¸º 40Ã—40ï¼Œå¹¶åŠ ä¸ªåœ†è§’ */
  #chain-filter .facet-row[data-label="Color"] .color-img-value img {
    width: 40px !important;
    height: 40px !important;
    border-radius: 6px;
    object-fit: cover;
  }

  /* ä¿ç•™åŸæœ‰ .color-block æ ·å¼ï¼Œå…¶ä»–é¢œè‰²ä»ç„¶æ˜¾ç¤ºç©ºåœˆ */
  #chain-filter .facet-row[data-label="Color"] .color-img-value .color-block {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    border: 1px solid #ccc;
  }

  /* ä¿è¯æ–‡å­—è¡Œé«˜ã€é—´è·ä¸å˜ */
  #chain-filter .facet-row[data-label="Color"] .color-img-value span:last-child {
    margin-top: 0.5rem;
    display: block;
  }

  /* è®©å›¾ç‰‡é€‰ä¸­æ—¶ä¹Ÿé«˜äº® */
  #chain-filter .facet-row[data-label="Color"] .color-img-value.checked img {
    outline: 2px solid #007bff;
    border-radius: 6px;
  }
  /* é«˜äº®æ•´ä¸ªè¢«é€‰ä¸­çš„ Color ç“¦ç‰‡ */
  #chain-filter .facet-row[data-label="Color"] .facet-value.checked {
    background: rgba(0,123,255,0.1);
    border-color: #007bff !important;
  }

  /* ï¼ˆå¯é€‰ï¼‰ç»™è¢«é€‰ä¸­çš„å›¾ç‰‡åŠ ä¸ªè“è‰²è¾¹æ¡† */
  #chain-filter .facet-row[data-label="Color"] .color-img-value.checked img {
    outline: 2px solid #007bff;
  }

/* Length è¾“å…¥æ¡†å’Œ slider çš„æ’ç‰ˆä¼˜åŒ– */

/* é»˜è®¤ï¼šå¤§å±æ—¶ï¼Œè®©è¾“å…¥æ¡†å’Œ slider ä¸Šä¸‹æœ‰é—´è· */
#chain-filter .length-inputs {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1.5rem; /* ğŸ‘‰ slider å‰ç©ºå‡ºç©ºé—´ */
}

  /* è¾“å…¥æ¡†æ ·å¼ä¿æŒç»Ÿä¸€ */
  #chain-filter .length-inputs input[type="number"] {
    width: 120px;
    padding: .35rem .5rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: .95rem;
    box-sizing: border-box;
  }

  /* å°å±æ—¶ï¼šè¾“å…¥æ¡†æ”¹ä¸ºä¸€è¡Œä¸€ä¸ªï¼Œ100% å®½åº¦ï¼Œå·¦å³ä¸ç•™ç™½ */
  @media (max-width: 640px) {
    #chain-filter .length-inputs {
      flex-direction: column;
      align-items: stretch;
      gap: .75rem;
      margin-bottom: 1rem; /* å’Œ slider ä¹‹é—´ç•™ç‚¹ç©ºé—´ */
    }
    #chain-filter .length-inputs input[type="number"] {
      width: 100%;  /* é“ºæ»¡å®¹å™¨ */
    }
  }


  </style>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(location.search);

      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        if (params.getAll(cb.name).includes(cb.value)) {
          cb.checked = true;
        }
      });

      const priceMinInput = document.querySelector('input[name="filter.v.price.gte"]');
      const priceMaxInput = document.querySelector('input[name="filter.v.price.lte"]');
      if (priceMinInput) priceMinInput.value = params.get('filter.v.price.gte') || '';
      if (priceMaxInput) priceMaxInput.value = params.get('filter.v.price.lte') || '';

      const sliderEl = document.getElementById('length-slider');
      const minIn = document.getElementById('length-min');
      const maxIn = document.getElementById('length-max');
      const form = document.getElementById('FacetFiltersForm');
      if (sliderEl && minIn && maxIn && form) {
        const minVal = parseFloat(sliderEl.dataset.min);
        const maxVal = parseFloat(sliderEl.dataset.max);
        const lowUrl = params.get('filter.p.m.custom.length_min');
        const highUrl = params.get('filter.p.m.custom.length_max');
        const startMin = lowUrl ? parseFloat(lowUrl) : minVal;
        const startMax = highUrl ? parseFloat(highUrl) : maxVal;

        noUiSlider.create(sliderEl, {
          start: [startMin, startMax],
          connect: true,
          step: 0.5,
          range: { min: minVal, max: maxVal },
          tooltips: [true, true],
          format: {
            to: v => v.toFixed(1) + 'cm',
            from: v => Number(v.replace('cm', ''))
          }
        });

        minIn.value = startMin;
        maxIn.value = startMax;

        const minUi = document.getElementById('length-min-ui');
        const maxUi = document.getElementById('length-max-ui');

        if (minUi && maxUi) {
   
          minUi.value = (+startMin).toFixed(1);
          maxUi.value = (+startMax).toFixed(1);

          sliderEl.noUiSlider.on('update', ([low, high]) => {
            if (minUi) minUi.value = parseFloat(low).toFixed(1);
            if (maxUi) maxUi.value = parseFloat(high).toFixed(1);
          });

          const clamp = (v, lo, hi) => Math.min(Math.max(v, lo), hi);
          const applyFromInputs = () => {
            let a = parseFloat(minUi.value);
            let b = parseFloat(maxUi.value);
            if (isNaN(a)) a = minVal;
            if (isNaN(b)) b = maxVal;
            a = clamp(a, minVal, maxVal);
            b = clamp(b, minVal, maxVal);
            if (a > b) b = a;         
            sliderEl.noUiSlider.set([a, b]);
          };
          minUi.addEventListener('change', applyFromInputs);
          maxUi.addEventListener('change', applyFromInputs);
        }
        sliderEl.noUiSlider.on('set', ([low, high]) => {
          low = parseFloat(low); high = parseFloat(high);
          document.querySelectorAll('.js-length-range').forEach(cb => {
            const [lo, hi] = cb.value.replace('cm', '').split('-').map(parseFloat);
            cb.checked = !(hi < low || lo > high);
          });
          // â€”â€” æ–°å¢ï¼šAdjustable é€‰é¡¹é€»è¾‘ â€”â€” 
          document
            .querySelectorAll('.facet-row[data-label="Length"] .facet-values input[type="checkbox"]')
            .forEach(cb => {
              if (cb.value.includes('Adjustable')) {
                const m = cb.value.match(/(\d+(\.\d+)?)/);
                if (m) {
                  const val = parseFloat(m[0]);
                  cb.checked = val >= low && val <= high;
                }
              }
            });


          
          minIn.value = low;
          maxIn.value = high;
        });

        form.addEventListener('submit', () => {
          if (Array.from(document.querySelectorAll('.js-length-range')).some(cb => cb.checked)) {
            minIn.name = 'filter.p.m.custom.length_min';
            maxIn.name = 'filter.p.m.custom.length_max';
          } else {
            minIn.removeAttribute('name');
            maxIn.removeAttribute('name');
          }
        });
      }

      // â€”â€” æ„é€ å·²é€‰æ±‡æ€» â€”â€” 
      const desiredOrder = ["Color", "Alloy", "Availability", "Length", "Weight", "Price", "Width", "Design"];
      const summaryParts = [];
      
      desiredOrder.forEach(label => {
        let partsForLabel = [];
      
        if (label === "Availability") {
          // å¤„ç† In stock / Out of stock
          params.getAll('filter.v.availability').forEach(v => {
            if (v === 'true' || v === '1') partsForLabel.push('In stock');
            if (v === 'false' || v === '0') partsForLabel.push('Out of stock');
          });
      
        } else if (label === "Price") {
          const min = params.get('filter.v.price.gte');
          const max = params.get('filter.v.price.lte');
          if (min) partsForLabel.push(`Min Price: ${min}`);
          if (max) partsForLabel.push(`Max Price: ${max}`);
      
        } else if (label === "Length") {
          const low = params.get('filter.p.m.custom.length_min');
          const high= params.get('filter.p.m.custom.length_max');
          if (low && high) partsForLabel.push(`Length: ${low}â€“${high}cm`);
          // åŠ ä¸Šæ‰€æœ‰ Adjustable
          params.getAll('filter.p.m.custom.length').forEach(v => {
            if (v.includes('Adjustable')) partsForLabel.push(v);
          });
      
        } else {
          // é€šç”¨å¤„ç† list ç±»å‹çš„ filter
          const paramMap = {
            "Design":  'filter.p.product_type',
            "Alloy":   'filter.v.option.alloy',
            "Color":   'filter.p.m.custom.color',            // å¦‚æœå®é™… param_name ä¸ä¸€æ ·è¯·æ”¹è¿™é‡Œ
            "Weight":  'filter.p.m.custom.weight_range',
            "Width":   'filter.p.m.custom.width_range'
          };
          const p = paramMap[label];
          if (p) {
            params.getAll(p).forEach(v => partsForLabel.push(v));
          }
        }
      
        if (partsForLabel.length) {
          // å»é‡åæ‹¼æˆä¸€æ¡ summary
          const uniq = [...new Set(partsForLabel)];
          summaryParts.push(`${label}: ${uniq.join('ï¼Œ ')}`);
        }
      });
      
      // æ¸²æŸ“åˆ°é¡µé¢
      const summaryEl = document.getElementById('applied-summary');
      summaryEl.innerHTML = summaryParts.length
        ? `<strong>You have selectedï¼š</strong>${summaryParts.join('ï¼› ')}`
        : '';

      document.getElementById('clear-all').addEventListener('click', () => {
        location.href = '{{ coll.url }}';
      });

      document.querySelectorAll('.facet-row[data-label="Color"] .facet-value')
      .forEach(wrapper => {
        const cb = wrapper.querySelector('input[type="checkbox"]');
        // å…ˆæŠŠåˆå§‹é€‰ä¸­æ€æ‰“ä¸Š
        if (cb.checked) wrapper.classList.add('checked');
        // ç‚¹å‡»åˆ‡æ¢æ—¶æ‰“/å» .checked
        cb.addEventListener('change', () => {
          wrapper.classList.toggle('checked', cb.checked);
        });
      });

      document.querySelectorAll(
        '#chain-filter .facet-row[data-label="Design"] .design-value'
      ).forEach(wrapper => {
        const cb = wrapper.querySelector('input[type="checkbox"]');
        if (cb.checked) wrapper.classList.add('checked');
        cb.addEventListener('change', () => {
          wrapper.classList.toggle('checked', cb.checked);
        });
      }); 

      

    });

    const form = document.getElementById('FacetFiltersForm');

    form.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault(); 
      }
    });

  </script>

</section>

{% schema %}
{
  "name": "Searay Filters",
  "settings": [{ "type": "collection", "id": "custom_collection", "label": "Collection (blank=current)" }],
  "presets": [{ "name": "Searay Filters" }]
}
{% endschema %}
